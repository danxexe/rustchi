<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rustchi</title>
  </head>
  <body>
    <style>
      @font-face {
        font-family: 'FiraMono';
        src: url("FiraMonoNerdFont-Regular.otf") format('opentype');
      }
      body {
        color: white;
        background: black;
      }
      pre {
        font-family: 'FiraMono';
        line-height: 1.18em;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/ansi_up@5.2.1/ansi_up.min.js" type="text/javascript"></script>
    <script>
      let t = 0;
      let buffer = "";
      window.ansi_up = (data) => {
        t += 1;
        let html = (new AnsiUp).ansi_to_html(data);
        buffer += html;
      }

      let flushed_t = 0;
      let flush = () => {
        if (flushed_t < t) {
          let output = document.getElementById("output");
          output.innerHTML = buffer;
          window.scrollTo(0, document.body.scrollHeight);
        }
        flushed_t = t;
        window.requestAnimationFrame(flush);
      }

      window.requestAnimationFrame(flush);
    </script>
    <script type="module">
        import init, { run  } from './rustchi-wasm/rustchi_wasm.js';

        (async () => {
            await init();
            console.log("starting emulator...");
            await run("https://f005.backblazeb2.com/file/danxexe/rustchi/rom.bin")
            console.log("done.");
        })()
      </script>
      <pre id="output"></pre>
  </body>
</html>
