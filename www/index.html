<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>rustchi</title>
  </head>
  <body>
    <pre id="output"></pre>
    <style>
      @font-face {
        font-family: 'FiraMono';
        src: url("FiraMonoNerdFont-Regular.otf") format('opentype');
      }
      body {
        color: white;
        background: black;
      }
      pre {
        font-family: 'FiraMono';
        line-height: 1.18em;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/ansi_up@5.2.1/ansi_up.min.js" type="text/javascript"></script>
    <script>
      let t = 0;
      let ansi = (new AnsiUp);

      let buffer = {
        data: "",
        el: document.getElementById("output"),

        write: function(data) {
          this.data += data;
        },
        flush: function() {
          this.el.innerHTML = this.data;
          this.data = '';
        },
      };

      window.ansi_up = (data) => {
        let html = ansi.ansi_to_html(data);
        buffer.write(html);
      }
    </script>
    <script type="module">
        import init, { Emulator } from './rustchi-wasm/rustchi_wasm.js';

        (async () => {
            await init();
            console.log("loading ROM...");
            let emulator = await Emulator.load("https://f005.backblazeb2.com/file/danxexe/rustchi/rom.bin")
            console.log("ROM loaded.");

            let next_frame = () => {
              emulator.run_frame();
              buffer.flush();
              window.requestAnimationFrame(next_frame);
            }

            next_frame();
        })()
      </script>
  </body>
</html>
